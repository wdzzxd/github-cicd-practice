# 工作流名称（可自定义，会在 GitHub Actions 中显示）
name: CI/CD 自动校验并部署到 GitHub Pages
# 触发条件：当推送到 main 分支时执行（若仓库默认分支是 master，改为 branches: [ master ]）
on:
  push:
    branches: [ main ]
# 定义任务（一个工作流可包含多个任务，这里只有一个部署任务）
jobs:
  deploy-to-pages:
    # 运行环境：使用最新版 Ubuntu 服务器（GitHub 提供的免费 Runner）
    runs-on: ubuntu-latest
    # 任务步骤（按顺序执行）
    steps:
      # 步骤1：拉取仓库代码到 Runner 服务器
      - name: 拉取仓库代码
        uses: actions/checkout@v4  # 使用官方提供的「拉取代码」动作
      # 步骤2：校验 dist/index.html 是否存在（核心校验步骤）
      - name: 校验静态文件是否存在
        run: |  # 执行 Linux 命令（Runner 是 Ubuntu，支持 Bash 命令）
          if [ -f "dist/index.html" ]; then
            echo "✅ dist/index.html 文件存在，校验通过！"
          else
            echo "❌ dist/index.html 文件缺失，校验失败！"
            exit 1  # 退出码 1 表示失败，会终止后续步骤
          fi
      # 步骤3：部署到 GitHub Pages（使用第三方成熟动作，简化部署）
      - name: 部署到 GitHub Pages
        uses: peaceiris/actions-gh-pages@v4  # 第三方部署动作，稳定可靠
        with:
          github_token: ${{ secrets.GH_PAGES_TOKEN }}  # 自动生成的令牌，无需手动配置
          publish_dir: ./dist  # 要部署的目录（即静态文件所在目录）
          publish_branch: gh-pages  # 必须指定部署到 gh-pages 分支（GitHub Pages 专用分支）
          force_orphan: true  # 清空 gh-pages 分支历史，避免冲突（推荐开启）